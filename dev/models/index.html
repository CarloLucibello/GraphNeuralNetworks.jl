<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model Building · GraphNeuralNetworks.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../democards/gridtheme.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="GraphNeuralNetworks.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">GraphNeuralNetworks.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Graphs</span><ul><li><a class="tocitem" href="../gnngraph/">Working with GNNGraph</a></li><li><a class="tocitem" href="../heterograph/">Heterogeneous Graphs</a></li><li><a class="tocitem" href="../temporalgraph/">Temporal Graphs</a></li></ul></li><li><a class="tocitem" href="../messagepassing/">Message Passing</a></li><li class="is-active"><a class="tocitem" href>Model Building</a><ul class="internal"><li><a class="tocitem" href="#Explicit-modeling"><span>Explicit modeling</span></a></li><li><a class="tocitem" href="#Implicit-modeling-with-GNNChains"><span>Implicit modeling with GNNChains</span></a></li><li><a class="tocitem" href="#Embedding-a-graph-in-the-model"><span>Embedding a graph in the model</span></a></li></ul></li><li><a class="tocitem" href="../datasets/">Datasets</a></li><li><a class="tocitem" href="../tutorials/">Tutorials</a></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../api/gnngraph/">GNNGraph</a></li><li><a class="tocitem" href="../api/basic/">Basic Layers</a></li><li><a class="tocitem" href="../api/conv/">Convolutional Layers</a></li><li><a class="tocitem" href="../api/pool/">Pooling Layers</a></li><li><a class="tocitem" href="../api/messagepassing/">Message Passing</a></li><li><a class="tocitem" href="../api/heterograph/">Heterogeneous Graphs</a></li><li><a class="tocitem" href="../api/temporalgraph/">Temporal Graphs</a></li><li><a class="tocitem" href="../api/utils/">Utils</a></li></ul></li><li><a class="tocitem" href="../dev/">Developer Notes</a></li><li><a class="tocitem" href="../gsoc/">Summer Of Code</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Model Building</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model Building</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CarloLucibello/GraphNeuralNetworks.jl/blob/master/docs/src/models.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Models"><a class="docs-heading-anchor" href="#Models">Models</a><a id="Models-1"></a><a class="docs-heading-anchor-permalink" href="#Models" title="Permalink"></a></h1><p>GraphNeuralNetworks.jl provides common graph convolutional layers by which you can assemble arbitrarily deep or complex models. GNN layers are compatible with  Flux.jl ones, therefore expert Flux users are promptly able to define and train  their models. </p><p>In what follows, we discuss two different styles for model creation: the <em>explicit modeling</em> style, more verbose but more flexible,  and the <em>implicit modeling</em> style based on <a href="../api/basic/#GraphNeuralNetworks.GNNChain"><code>GNNChain</code></a>, more concise but less flexible.</p><h2 id="Explicit-modeling"><a class="docs-heading-anchor" href="#Explicit-modeling">Explicit modeling</a><a id="Explicit-modeling-1"></a><a class="docs-heading-anchor-permalink" href="#Explicit-modeling" title="Permalink"></a></h2><p>In the explicit modeling style, the model is created according to the following steps:</p><ol><li>Define a new type for your model (<code>GNN</code> in the example below). Layers and submodels are fields.</li><li>Apply <code>Flux.@functor</code> to the new type to make it Flux&#39;s compatible (parameters&#39; collection, gpu movement, etc...)</li><li>Optionally define a convenience constructor for your model.</li><li>Define the forward pass by implementing the call method for your type.</li><li>Instantiate the model. </li></ol><p>Here is an example of this construction:</p><pre><code class="language-julia hljs">using Flux, Graphs, GraphNeuralNetworks

struct GNN                                # step 1
    conv1
    bn
    conv2
    dropout
    dense
end

Flux.@functor GNN                         # step 2

function GNN(din::Int, d::Int, dout::Int) # step 3    
    GNN(GCNConv(din =&gt; d),
        BatchNorm(d),
        GraphConv(d =&gt; d, relu),
        Dropout(0.5),
        Dense(d, dout))
end

function (model::GNN)(g::GNNGraph, x)     # step 4
    x = model.conv1(g, x)
    x = relu.(model.bn(x))
    x = model.conv2(g, x)
    x = model.dropout(x)
    x = model.dense(x)
    return x 
end

din, d, dout = 3, 4, 2 
model = GNN(din, d, dout)                 # step 5

g = rand_graph(10, 30)
X = randn(Float32, din, 10) 

y = model(g, X)  # output size: (dout, g.num_nodes)
grad = gradient(model -&gt; sum(model(g, X)), model)</code></pre><h2 id="Implicit-modeling-with-GNNChains"><a class="docs-heading-anchor" href="#Implicit-modeling-with-GNNChains">Implicit modeling with GNNChains</a><a id="Implicit-modeling-with-GNNChains-1"></a><a class="docs-heading-anchor-permalink" href="#Implicit-modeling-with-GNNChains" title="Permalink"></a></h2><p>While very flexible, the way in which we defined <code>GNN</code> model definition in last section is a bit verbose. In order to simplify things, we provide the <a href="../api/basic/#GraphNeuralNetworks.GNNChain"><code>GNNChain</code></a> type. It is very similar  to Flux&#39;s well known <code>Chain</code>. It allows to compose layers in a sequential fashion as Chain does, propagating the output of each layer to the next one. In addition, <code>GNNChain</code>  handles propagates the input graph as well, providing it as a first argument to layers subtyping the <a href="../api/basic/#GraphNeuralNetworks.GNNLayer"><code>GNNLayer</code></a> abstract type. </p><p>Using <code>GNNChain</code>, the previous example becomes</p><pre><code class="language-julia hljs">using Flux, Graphs, GraphNeuralNetworks

din, d, dout = 3, 4, 2 
g = rand_graph(10, 30)
X = randn(Float32, din, 10)

model = GNNChain(GCNConv(din =&gt; d),
                 BatchNorm(d),
                 x -&gt; relu.(x),
                 GCNConv(d =&gt; d, relu),
                 Dropout(0.5),
                 Dense(d, dout))</code></pre><p>The <code>GNNChain</code> only propagates the graph and the node features. More complex scenarios, e.g. when also edge features are updated, have to be handled using the explicit definition of the forward pass. </p><p>A <code>GNNChain</code> opportunely propagates the graph into the branches created by the <code>Flux.Parallel</code> layer:</p><pre><code class="language-julia hljs">AddResidual(l) = Parallel(+, identity, l)  # implementing a skip/residual connection

model = GNNChain( ResGatedGraphConv(din =&gt; d, relu),
                  AddResidual(ResGatedGraphConv(d =&gt; d, relu)),
                  AddResidual(ResGatedGraphConv(d =&gt; d, relu)),
                  AddResidual(ResGatedGraphConv(d =&gt; d, relu)),
                  GlobalPooling(mean),
                  Dense(d, dout))

y = model(g, X) # output size: (dout, g.num_graphs)</code></pre><h2 id="Embedding-a-graph-in-the-model"><a class="docs-heading-anchor" href="#Embedding-a-graph-in-the-model">Embedding a graph in the model</a><a id="Embedding-a-graph-in-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Embedding-a-graph-in-the-model" title="Permalink"></a></h2><p>Sometimes it is useful to consider a specific graph as a part of a model instead of  its input. GraphNeuralNetworks.jl provides the <a href="../api/basic/#GraphNeuralNetworks.WithGraph"><code>WithGraph</code></a> type to deal with this scenario.</p><pre><code class="language-julia hljs">chain = GNNChain(GCNConv(din =&gt; d, relu),
                 GCNConv(d =&gt; d))


g = rand_graph(10, 30)

model = WithGraph(chain, g)

X = randn(Float32, din, 10)

# Pass only X as input, the model already contains the graph.
y = model(X) </code></pre><p>An example of <code>WithGraph</code> usage is given in the graph neural ODE script in the <a href="https://github.com/CarloLucibello/GraphNeuralNetworks.jl/tree/master/examples">examples</a> folder.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../messagepassing/">« Message Passing</a><a class="docs-footer-nextpage" href="../datasets/">Datasets »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 10 March 2024 23:00">Sunday 10 March 2024</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
