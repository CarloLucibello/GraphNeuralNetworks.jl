<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Models · GraphNeuralNetworks.jl</title><meta name="title" content="Models · GraphNeuralNetworks.jl"/><meta property="og:title" content="Models · GraphNeuralNetworks.jl"/><meta property="twitter:title" content="Models · GraphNeuralNetworks.jl"/><meta name="description" content="Documentation for GraphNeuralNetworks.jl."/><meta property="og:description" content="Documentation for GraphNeuralNetworks.jl."/><meta property="twitter:description" content="Documentation for GraphNeuralNetworks.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="GraphNeuralNetworks.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">GraphNeuralNetworks.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Monorepo</span><ul><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../dev/">Developer guide</a></li><li><a class="tocitem" href="../gsoc/">Google Summer of Code</a></li></ul></li><li><span class="tocitem">GraphNeuralNetworks.jl</span><ul><li><a class="tocitem" href="../home/">Home</a></li><li class="is-active"><a class="tocitem" href>Models</a><ul class="internal"><li><a class="tocitem" href="#Explicit-modeling"><span>Explicit modeling</span></a></li><li><a class="tocitem" href="#Implicit-modeling-with-GNNChains"><span>Implicit modeling with GNNChains</span></a></li><li><a class="tocitem" href="#Embedding-a-graph-in-the-model"><span>Embedding a graph in the model</span></a></li></ul></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../api/basic/">Basic</a></li><li><a class="tocitem" href="../api/conv/">Convolutional layers</a></li><li><a class="tocitem" href="../api/pool/">Pooling layers</a></li><li><a class="tocitem" href="../api/temporalconv/">Temporal Convolutional layers</a></li><li><a class="tocitem" href="../api/heteroconv/">Hetero Convolutional layers</a></li><li><a class="tocitem" href="../api/samplers/">Samplers</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">GraphNeuralNetworks.jl</a></li><li class="is-active"><a href>Models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Models</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaGraphs/GraphNeuralNetworks.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaGraphs/GraphNeuralNetworks.jl/blob/master/GraphNeuralNetworks/docs/src/models.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Models"><a class="docs-heading-anchor" href="#Models">Models</a><a id="Models-1"></a><a class="docs-heading-anchor-permalink" href="#Models" title="Permalink"></a></h1><p>GraphNeuralNetworks.jl provides common graph convolutional layers by which you can assemble arbitrarily deep or complex models. GNN layers are compatible with  Flux.jl ones, therefore expert Flux users are promptly able to define and train  their models. </p><p>In what follows, we discuss two different styles for model creation: the <em>explicit modeling</em> style, more verbose but more flexible,  and the <em>implicit modeling</em> style based on <a href="../api/basic/#GraphNeuralNetworks.GNNChain"><code>GraphNeuralNetworks.GNNChain</code></a>, more concise but less flexible.</p><h2 id="Explicit-modeling"><a class="docs-heading-anchor" href="#Explicit-modeling">Explicit modeling</a><a id="Explicit-modeling-1"></a><a class="docs-heading-anchor-permalink" href="#Explicit-modeling" title="Permalink"></a></h2><p>In the explicit modeling style, the model is created according to the following steps:</p><ol><li>Define a new type for your model (<code>GNN</code> in the example below). Layers and submodels are fields.</li><li>Apply <code>Flux.@layer</code> to the new type to make it Flux&#39;s compatible (parameters&#39; collection, gpu movement, etc...)</li><li>Optionally define a convenience constructor for your model.</li><li>Define the forward pass by implementing the call method for your type.</li><li>Instantiate the model. </li></ol><p>Here is an example of this construction:</p><pre><code class="language-julia hljs">using Flux, Graphs, GraphNeuralNetworks

struct GNN                                # step 1
    conv1
    bn
    conv2
    dropout
    dense
end

Flux.@layer GNN                         # step 2

function GNN(din::Int, d::Int, dout::Int) # step 3    
    GNN(GCNConv(din =&gt; d),
        BatchNorm(d),
        GraphConv(d =&gt; d, relu),
        Dropout(0.5),
        Dense(d, dout))
end

function (model::GNN)(g::GNNGraph, x)     # step 4
    x = model.conv1(g, x)
    x = relu.(model.bn(x))
    x = model.conv2(g, x)
    x = model.dropout(x)
    x = model.dense(x)
    return x 
end

din, d, dout = 3, 4, 2 
model = GNN(din, d, dout)                 # step 5

g = rand_graph(10, 30)
X = randn(Float32, din, 10) 

y = model(g, X)  # output size: (dout, g.num_nodes)
grad = gradient(model -&gt; sum(model(g, X)), model)</code></pre><h2 id="Implicit-modeling-with-GNNChains"><a class="docs-heading-anchor" href="#Implicit-modeling-with-GNNChains">Implicit modeling with GNNChains</a><a id="Implicit-modeling-with-GNNChains-1"></a><a class="docs-heading-anchor-permalink" href="#Implicit-modeling-with-GNNChains" title="Permalink"></a></h2><p>While very flexible, the way in which we defined <code>GNN</code> model definition in last section is a bit verbose. In order to simplify things, we provide the <a href="../api/basic/#GraphNeuralNetworks.GNNChain"><code>GraphNeuralNetworks.GNNChain</code></a> type. It is very similar  to Flux&#39;s well known <code>Chain</code>. It allows to compose layers in a sequential fashion as Chain does, propagating the output of each layer to the next one. In addition, <code>GNNChain</code>  handles propagates the input graph as well, providing it as a first argument to layers subtyping the <a href="../api/basic/#GraphNeuralNetworks.GNNLayer"><code>GraphNeuralNetworks.GNNLayer</code></a> abstract type. </p><p>Using <code>GNNChain</code>, the previous example becomes</p><pre><code class="language-julia hljs">using Flux, Graphs, GraphNeuralNetworks

din, d, dout = 3, 4, 2 
g = rand_graph(10, 30)
X = randn(Float32, din, 10)

model = GNNChain(GCNConv(din =&gt; d),
                 BatchNorm(d),
                 x -&gt; relu.(x),
                 GCNConv(d =&gt; d, relu),
                 Dropout(0.5),
                 Dense(d, dout))</code></pre><p>The <code>GNNChain</code> only propagates the graph and the node features. More complex scenarios, e.g. when also edge features are updated, have to be handled using the explicit definition of the forward pass. </p><p>A <code>GNNChain</code> opportunely propagates the graph into the branches created by the <code>Flux.Parallel</code> layer:</p><pre><code class="language-julia hljs">AddResidual(l) = Parallel(+, identity, l)  # implementing a skip/residual connection

model = GNNChain( ResGatedGraphConv(din =&gt; d, relu),
                  AddResidual(ResGatedGraphConv(d =&gt; d, relu)),
                  AddResidual(ResGatedGraphConv(d =&gt; d, relu)),
                  AddResidual(ResGatedGraphConv(d =&gt; d, relu)),
                  GlobalPooling(mean),
                  Dense(d, dout))

y = model(g, X) # output size: (dout, g.num_graphs)</code></pre><h2 id="Embedding-a-graph-in-the-model"><a class="docs-heading-anchor" href="#Embedding-a-graph-in-the-model">Embedding a graph in the model</a><a id="Embedding-a-graph-in-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Embedding-a-graph-in-the-model" title="Permalink"></a></h2><p>Sometimes it is useful to consider a specific graph as a part of a model instead of  its input. GraphNeuralNetworks.jl provides the <a href="../api/basic/#GraphNeuralNetworks.WithGraph"><code>WithGraph</code></a> type to deal with this scenario.</p><pre><code class="language-julia hljs">chain = GNNChain(GCNConv(din =&gt; d, relu),
                 GCNConv(d =&gt; d))


g = rand_graph(10, 30)

model = WithGraph(chain, g)

X = randn(Float32, din, 10)

# Pass only X as input, the model already contains the graph.
y = model(X) </code></pre><p>An example of <code>WithGraph</code> usage is given in the graph neural ODE script in the <a href="https://github.com/JuliaGraphs/GraphNeuralNetworks.jl/tree/master/examples">examples</a> folder.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../home/">« Home</a><a class="docs-footer-nextpage" href="../api/basic/">Basic »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 4 November 2024 13:32">Monday 4 November 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
